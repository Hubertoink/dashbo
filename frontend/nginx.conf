server {
  listen 80;
  server_name _;

  # Allow larger uploads (e.g. background images). Override via env var.
  # Must be >= backend multer limit (currently 10MB) plus multipart overhead.
  client_max_body_size ${CLIENT_MAX_BODY_SIZE};

  root /usr/share/nginx/html;
  index 200.html;

  # SvelteKit static fallback
  location / {
    try_files $uri $uri/ /200.html;
  }

  # Backend API proxy
  location /api/ {
    # NOTE: This file is used as an nginx template in the Docker image.
    # The official nginx entrypoint will envsubst variables in /etc/nginx/templates/*.template.
    #
    # Defaults (set in Dockerfile):
    # - API_PROXY_PASS=http://backend:3000/
    # - API_PROXY_HOST=backend
    #
    # In Mittwald (separate backend domain), set:
    # - API_PROXY_PASS=https://api.dashbohub.de/
    # - API_PROXY_HOST=api.dashbohub.de

    proxy_set_header Host ${API_PROXY_HOST};
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_http_version 1.1;

    proxy_ssl_server_name on;
    proxy_ssl_name ${API_PROXY_HOST};

    proxy_pass ${API_PROXY_PASS};
  }
}
